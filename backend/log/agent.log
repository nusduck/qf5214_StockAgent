2025-04-02 23:54:42,313 - helpers.logger - INFO - 创建股票代码搜索和基本信息获取代理
2025-04-02 23:58:25,164 - helpers.logger - INFO - 创建股票代码搜索和基本信息获取代理
2025-04-03 00:01:47,121 - helpers.logger - INFO - 创建股票代码搜索和基本信息获取代理
2025-04-03 00:04:15,821 - helpers.logger - INFO - 创建股票代码搜索和基本信息获取代理
2025-04-03 00:04:27,458 - helpers.logger - INFO - start_node处理公司信息完成
2025-04-03 14:32:19,081 - helpers.logger - INFO - 创建股票代码搜索和基本信息获取代理
2025-04-03 14:32:35,984 - helpers.logger - INFO - start_node处理公司信息完成
2025-04-03 14:33:52,543 - helpers.logger - INFO - 创建股票代码搜索和基本信息获取代理
2025-04-03 14:34:04,529 - helpers.logger - INFO - start_node处理公司信息完成
2025-04-03 14:35:18,004 - helpers.logger - INFO - 创建股票代码搜索和基本信息获取代理
2025-04-03 14:35:28,285 - helpers.logger - INFO - start_node处理公司信息完成
2025-04-03 14:39:24,947 - helpers.logger - INFO - 创建股票代码搜索和基本信息获取代理
2025-04-03 14:39:34,948 - helpers.logger - INFO - start_node处理公司信息完成
2025-04-03 14:48:26,267 - helpers.logger - INFO - 创建股票代码搜索和基本信息获取代理
2025-04-03 14:48:29,881 - helpers.logger - ERROR - 工作流执行错误: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
Traceback (most recent call last):
  File "/Users/tangyunpeng/Desktop/QF5214/backend/server.py", line 66, in run_workflow_with_higher_limit
    return run_stock_analysis(request.company_name, recursion_limit=200)
  File "/Users/tangyunpeng/Desktop/QF5214/backend/core/workflow.py", line 113, in run_stock_analysis
    return workflow.invoke(state, config={"recursion_limit": recursion_limit})
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2676, in invoke
    for chunk in self.stream(
                 ~~~~~~~~~~~^
        input,
        ^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ):
    ^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2324, in stream
    for _ in runner.tick(
             ~~~~~~~~~~~^
        loop.tasks.values(),
        ^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        get_waiter=get_waiter,
        ^^^^^^^^^^^^^^^^^^^^^^
    ):
    ^
  File "/Users/tangyunpeng/Desktop/QF5214/backend/node/start_node.py", line 23, in process_company_node
    result = agent.invoke(state)
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2676, in invoke
    for chunk in self.stream(
                 ~~~~~~~~~~~^
        input,
        ^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ):
    ^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2324, in stream
    for _ in runner.tick(
             ~~~~~~~~~~~^
        loop.tasks.values(),
        ^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        get_waiter=get_waiter,
        ^^^^^^^^^^^^^^^^^^^^^^
    ):
    ^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/langgraph/prebuilt/chat_agent_executor.py", line 685, in call_model
    response = cast(AIMessage, model_runnable.invoke(state, config))
                               ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/langchain_core/runnables/base.py", line 3016, in invoke
    input = context.run(step.invoke, input, config)
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/langchain_core/runnables/base.py", line 5352, in invoke
    return self.bound.invoke(
           ~~~~~~~~~~~~~~~~~^
        input,
        ^^^^^^
        self._merge_configs(config),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        **{**self.kwargs, **kwargs},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 284, in invoke
    self.generate_prompt(
    ~~~~~~~~~~~~~~~~~~~~^
        [self._convert_input(input)],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ).generations[0][0],
    ^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 860, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 690, in generate
    self._generate_with_cache(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        m,
        ^^
    ...<2 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 925, in _generate_with_cache
    result = self._generate(
        messages, stop=stop, run_manager=run_manager, **kwargs
    )
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/langchain_openai/chat_models/base.py", line 792, in _generate
    response = self.client.create(**payload)
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/openai/_utils/_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/openai/resources/chat/completions.py", line 863, in create
    return self._post(
           ~~~~~~~~~~^
        "/chat/completions",
        ^^^^^^^^^^^^^^^^^^^^
    ...<40 lines>...
        stream_cls=Stream[ChatCompletionChunk],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/openai/_base_client.py", line 1283, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/openai/_base_client.py", line 960, in request
    return self._request(
           ~~~~~~~~~~~~~^
        cast_to=cast_to,
        ^^^^^^^^^^^^^^^^
    ...<3 lines>...
        retries_taken=retries_taken,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/openai/_base_client.py", line 1049, in _request
    return self._retry_request(
           ~~~~~~~~~~~~~~~~~~~^
        input_options,
        ^^^^^^^^^^^^^^
    ...<4 lines>...
        stream_cls=stream_cls,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/openai/_base_client.py", line 1098, in _retry_request
    return self._request(
           ~~~~~~~~~~~~~^
        options=options,
        ^^^^^^^^^^^^^^^^
    ...<3 lines>...
        stream_cls=stream_cls,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/openai/_base_client.py", line 1049, in _request
    return self._retry_request(
           ~~~~~~~~~~~~~~~~~~~^
        input_options,
        ^^^^^^^^^^^^^^
    ...<4 lines>...
        stream_cls=stream_cls,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/openai/_base_client.py", line 1098, in _retry_request
    return self._request(
           ~~~~~~~~~~~~~^
        options=options,
        ^^^^^^^^^^^^^^^^
    ...<3 lines>...
        stream_cls=stream_cls,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/openai/_base_client.py", line 1064, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
During task with name 'agent' and id 'a2a2e96d-2cbb-9bc7-3ffd-2f6235bf601e'
During task with name 'company_info' and id '8cdddbbb-62ed-5503-aa32-b8bde0e499de'

2025-04-03 14:48:29,885 - helpers.logger - ERROR - API错误: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
Traceback (most recent call last):
  File "/Users/tangyunpeng/Desktop/QF5214/backend/server.py", line 74, in analyze_stock
    results = await loop.run_in_executor(None, run_workflow_with_higher_limit)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.2/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/tangyunpeng/Desktop/QF5214/backend/server.py", line 70, in run_workflow_with_higher_limit
    raise e
  File "/Users/tangyunpeng/Desktop/QF5214/backend/server.py", line 66, in run_workflow_with_higher_limit
    return run_stock_analysis(request.company_name, recursion_limit=200)
  File "/Users/tangyunpeng/Desktop/QF5214/backend/core/workflow.py", line 113, in run_stock_analysis
    return workflow.invoke(state, config={"recursion_limit": recursion_limit})
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2676, in invoke
    for chunk in self.stream(
                 ~~~~~~~~~~~^
        input,
        ^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ):
    ^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2324, in stream
    for _ in runner.tick(
             ~~~~~~~~~~~^
        loop.tasks.values(),
        ^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        get_waiter=get_waiter,
        ^^^^^^^^^^^^^^^^^^^^^^
    ):
    ^
  File "/Users/tangyunpeng/Desktop/QF5214/backend/node/start_node.py", line 23, in process_company_node
    result = agent.invoke(state)
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2676, in invoke
    for chunk in self.stream(
                 ~~~~~~~~~~~^
        input,
        ^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ):
    ^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2324, in stream
    for _ in runner.tick(
             ~~~~~~~~~~~^
        loop.tasks.values(),
        ^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        get_waiter=get_waiter,
        ^^^^^^^^^^^^^^^^^^^^^^
    ):
    ^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/langgraph/prebuilt/chat_agent_executor.py", line 685, in call_model
    response = cast(AIMessage, model_runnable.invoke(state, config))
                               ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/langchain_core/runnables/base.py", line 3016, in invoke
    input = context.run(step.invoke, input, config)
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/langchain_core/runnables/base.py", line 5352, in invoke
    return self.bound.invoke(
           ~~~~~~~~~~~~~~~~~^
        input,
        ^^^^^^
        self._merge_configs(config),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        **{**self.kwargs, **kwargs},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 284, in invoke
    self.generate_prompt(
    ~~~~~~~~~~~~~~~~~~~~^
        [self._convert_input(input)],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ).generations[0][0],
    ^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 860, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 690, in generate
    self._generate_with_cache(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        m,
        ^^
    ...<2 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 925, in _generate_with_cache
    result = self._generate(
        messages, stop=stop, run_manager=run_manager, **kwargs
    )
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/langchain_openai/chat_models/base.py", line 792, in _generate
    response = self.client.create(**payload)
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/openai/_utils/_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/openai/resources/chat/completions.py", line 863, in create
    return self._post(
           ~~~~~~~~~~^
        "/chat/completions",
        ^^^^^^^^^^^^^^^^^^^^
    ...<40 lines>...
        stream_cls=Stream[ChatCompletionChunk],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/openai/_base_client.py", line 1283, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/openai/_base_client.py", line 960, in request
    return self._request(
           ~~~~~~~~~~~~~^
        cast_to=cast_to,
        ^^^^^^^^^^^^^^^^
    ...<3 lines>...
        retries_taken=retries_taken,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/openai/_base_client.py", line 1049, in _request
    return self._retry_request(
           ~~~~~~~~~~~~~~~~~~~^
        input_options,
        ^^^^^^^^^^^^^^
    ...<4 lines>...
        stream_cls=stream_cls,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/openai/_base_client.py", line 1098, in _retry_request
    return self._request(
           ~~~~~~~~~~~~~^
        options=options,
        ^^^^^^^^^^^^^^^^
    ...<3 lines>...
        stream_cls=stream_cls,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/openai/_base_client.py", line 1049, in _request
    return self._retry_request(
           ~~~~~~~~~~~~~~~~~~~^
        input_options,
        ^^^^^^^^^^^^^^
    ...<4 lines>...
        stream_cls=stream_cls,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/openai/_base_client.py", line 1098, in _retry_request
    return self._request(
           ~~~~~~~~~~~~~^
        options=options,
        ^^^^^^^^^^^^^^^^
    ...<3 lines>...
        stream_cls=stream_cls,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/openai/_base_client.py", line 1064, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
During task with name 'agent' and id 'a2a2e96d-2cbb-9bc7-3ffd-2f6235bf601e'
During task with name 'company_info' and id '8cdddbbb-62ed-5503-aa32-b8bde0e499de'

2025-04-03 15:22:55,134 - helpers.logger - INFO - 创建股票代码搜索和基本信息获取代理
2025-04-03 15:22:57,883 - helpers.logger - ERROR - 工作流执行错误: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
Traceback (most recent call last):
  File "/Users/tangyunpeng/Desktop/QF5214/backend/server.py", line 66, in run_workflow_with_higher_limit
    return run_stock_analysis(request.company_name, recursion_limit=200)
  File "/Users/tangyunpeng/Desktop/QF5214/backend/core/workflow.py", line 113, in run_stock_analysis
    return workflow.invoke(state, config={"recursion_limit": recursion_limit})
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2676, in invoke
    for chunk in self.stream(
                 ~~~~~~~~~~~^
        input,
        ^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ):
    ^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2324, in stream
    for _ in runner.tick(
             ~~~~~~~~~~~^
        loop.tasks.values(),
        ^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        get_waiter=get_waiter,
        ^^^^^^^^^^^^^^^^^^^^^^
    ):
    ^
  File "/Users/tangyunpeng/Desktop/QF5214/backend/node/start_node.py", line 23, in process_company_node
    result = agent.invoke(state)
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2676, in invoke
    for chunk in self.stream(
                 ~~~~~~~~~~~^
        input,
        ^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ):
    ^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2324, in stream
    for _ in runner.tick(
             ~~~~~~~~~~~^
        loop.tasks.values(),
        ^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        get_waiter=get_waiter,
        ^^^^^^^^^^^^^^^^^^^^^^
    ):
    ^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/langgraph/prebuilt/chat_agent_executor.py", line 685, in call_model
    response = cast(AIMessage, model_runnable.invoke(state, config))
                               ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/langchain_core/runnables/base.py", line 3016, in invoke
    input = context.run(step.invoke, input, config)
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/langchain_core/runnables/base.py", line 5352, in invoke
    return self.bound.invoke(
           ~~~~~~~~~~~~~~~~~^
        input,
        ^^^^^^
        self._merge_configs(config),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        **{**self.kwargs, **kwargs},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 284, in invoke
    self.generate_prompt(
    ~~~~~~~~~~~~~~~~~~~~^
        [self._convert_input(input)],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ).generations[0][0],
    ^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 860, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 690, in generate
    self._generate_with_cache(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        m,
        ^^
    ...<2 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 925, in _generate_with_cache
    result = self._generate(
        messages, stop=stop, run_manager=run_manager, **kwargs
    )
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/langchain_openai/chat_models/base.py", line 792, in _generate
    response = self.client.create(**payload)
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/openai/_utils/_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/openai/resources/chat/completions.py", line 863, in create
    return self._post(
           ~~~~~~~~~~^
        "/chat/completions",
        ^^^^^^^^^^^^^^^^^^^^
    ...<40 lines>...
        stream_cls=Stream[ChatCompletionChunk],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/openai/_base_client.py", line 1283, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/openai/_base_client.py", line 960, in request
    return self._request(
           ~~~~~~~~~~~~~^
        cast_to=cast_to,
        ^^^^^^^^^^^^^^^^
    ...<3 lines>...
        retries_taken=retries_taken,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/openai/_base_client.py", line 1049, in _request
    return self._retry_request(
           ~~~~~~~~~~~~~~~~~~~^
        input_options,
        ^^^^^^^^^^^^^^
    ...<4 lines>...
        stream_cls=stream_cls,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/openai/_base_client.py", line 1098, in _retry_request
    return self._request(
           ~~~~~~~~~~~~~^
        options=options,
        ^^^^^^^^^^^^^^^^
    ...<3 lines>...
        stream_cls=stream_cls,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/openai/_base_client.py", line 1049, in _request
    return self._retry_request(
           ~~~~~~~~~~~~~~~~~~~^
        input_options,
        ^^^^^^^^^^^^^^
    ...<4 lines>...
        stream_cls=stream_cls,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/openai/_base_client.py", line 1098, in _retry_request
    return self._request(
           ~~~~~~~~~~~~~^
        options=options,
        ^^^^^^^^^^^^^^^^
    ...<3 lines>...
        stream_cls=stream_cls,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/openai/_base_client.py", line 1064, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
During task with name 'agent' and id '3accd5be-06c2-7aa3-fddf-1a426d8d37d0'
During task with name 'company_info' and id 'bb852a8d-f113-e97f-f639-4e93e9def9dc'

2025-04-03 15:22:57,887 - helpers.logger - ERROR - API错误: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
Traceback (most recent call last):
  File "/Users/tangyunpeng/Desktop/QF5214/backend/server.py", line 74, in analyze_stock
    results = await loop.run_in_executor(None, run_workflow_with_higher_limit)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/homebrew/Cellar/python@3.13/3.13.2/Frameworks/Python.framework/Versions/3.13/lib/python3.13/concurrent/futures/thread.py", line 59, in run
    result = self.fn(*self.args, **self.kwargs)
  File "/Users/tangyunpeng/Desktop/QF5214/backend/server.py", line 70, in run_workflow_with_higher_limit
    raise e
  File "/Users/tangyunpeng/Desktop/QF5214/backend/server.py", line 66, in run_workflow_with_higher_limit
    return run_stock_analysis(request.company_name, recursion_limit=200)
  File "/Users/tangyunpeng/Desktop/QF5214/backend/core/workflow.py", line 113, in run_stock_analysis
    return workflow.invoke(state, config={"recursion_limit": recursion_limit})
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2676, in invoke
    for chunk in self.stream(
                 ~~~~~~~~~~~^
        input,
        ^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ):
    ^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2324, in stream
    for _ in runner.tick(
             ~~~~~~~~~~~^
        loop.tasks.values(),
        ^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        get_waiter=get_waiter,
        ^^^^^^^^^^^^^^^^^^^^^^
    ):
    ^
  File "/Users/tangyunpeng/Desktop/QF5214/backend/node/start_node.py", line 23, in process_company_node
    result = agent.invoke(state)
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2676, in invoke
    for chunk in self.stream(
                 ~~~~~~~~~~~^
        input,
        ^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ):
    ^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/langgraph/pregel/__init__.py", line 2324, in stream
    for _ in runner.tick(
             ~~~~~~~~~~~^
        loop.tasks.values(),
        ^^^^^^^^^^^^^^^^^^^^
    ...<2 lines>...
        get_waiter=get_waiter,
        ^^^^^^^^^^^^^^^^^^^^^^
    ):
    ^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/langgraph/prebuilt/chat_agent_executor.py", line 685, in call_model
    response = cast(AIMessage, model_runnable.invoke(state, config))
                               ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/langchain_core/runnables/base.py", line 3016, in invoke
    input = context.run(step.invoke, input, config)
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/langchain_core/runnables/base.py", line 5352, in invoke
    return self.bound.invoke(
           ~~~~~~~~~~~~~~~~~^
        input,
        ^^^^^^
        self._merge_configs(config),
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        **{**self.kwargs, **kwargs},
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 284, in invoke
    self.generate_prompt(
    ~~~~~~~~~~~~~~~~~~~~^
        [self._convert_input(input)],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<6 lines>...
        **kwargs,
        ^^^^^^^^^
    ).generations[0][0],
    ^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 860, in generate_prompt
    return self.generate(prompt_messages, stop=stop, callbacks=callbacks, **kwargs)
           ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 690, in generate
    self._generate_with_cache(
    ~~~~~~~~~~~~~~~~~~~~~~~~~^
        m,
        ^^
    ...<2 lines>...
        **kwargs,
        ^^^^^^^^^
    )
    ^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/langchain_core/language_models/chat_models.py", line 925, in _generate_with_cache
    result = self._generate(
        messages, stop=stop, run_manager=run_manager, **kwargs
    )
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/langchain_openai/chat_models/base.py", line 792, in _generate
    response = self.client.create(**payload)
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/openai/_utils/_utils.py", line 279, in wrapper
    return func(*args, **kwargs)
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/openai/resources/chat/completions.py", line 863, in create
    return self._post(
           ~~~~~~~~~~^
        "/chat/completions",
        ^^^^^^^^^^^^^^^^^^^^
    ...<40 lines>...
        stream_cls=Stream[ChatCompletionChunk],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/openai/_base_client.py", line 1283, in post
    return cast(ResponseT, self.request(cast_to, opts, stream=stream, stream_cls=stream_cls))
                           ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/openai/_base_client.py", line 960, in request
    return self._request(
           ~~~~~~~~~~~~~^
        cast_to=cast_to,
        ^^^^^^^^^^^^^^^^
    ...<3 lines>...
        retries_taken=retries_taken,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/openai/_base_client.py", line 1049, in _request
    return self._retry_request(
           ~~~~~~~~~~~~~~~~~~~^
        input_options,
        ^^^^^^^^^^^^^^
    ...<4 lines>...
        stream_cls=stream_cls,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/openai/_base_client.py", line 1098, in _retry_request
    return self._request(
           ~~~~~~~~~~~~~^
        options=options,
        ^^^^^^^^^^^^^^^^
    ...<3 lines>...
        stream_cls=stream_cls,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/openai/_base_client.py", line 1049, in _request
    return self._retry_request(
           ~~~~~~~~~~~~~~~~~~~^
        input_options,
        ^^^^^^^^^^^^^^
    ...<4 lines>...
        stream_cls=stream_cls,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/openai/_base_client.py", line 1098, in _retry_request
    return self._request(
           ~~~~~~~~~~~~~^
        options=options,
        ^^^^^^^^^^^^^^^^
    ...<3 lines>...
        stream_cls=stream_cls,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Users/tangyunpeng/Desktop/QF5214/.venv/lib/python3.13/site-packages/openai/_base_client.py", line 1064, in _request
    raise self._make_status_error_from_response(err.response) from None
openai.RateLimitError: Error code: 429 - {'error': {'message': 'You exceeded your current quota, please check your plan and billing details. For more information on this error, read the docs: https://platform.openai.com/docs/guides/error-codes/api-errors.', 'type': 'insufficient_quota', 'param': None, 'code': 'insufficient_quota'}}
During task with name 'agent' and id '3accd5be-06c2-7aa3-fddf-1a426d8d37d0'
During task with name 'company_info' and id 'bb852a8d-f113-e97f-f639-4e93e9def9dc'

2025-04-03 15:38:56,620 - helpers.logger - INFO - 创建股票代码搜索和基本信息获取代理
2025-04-03 15:39:09,045 - helpers.logger - INFO - start_node处理公司信息完成
2025-04-03 22:27:41,336 - helpers.logger - INFO - 创建股票代码搜索和基本信息获取代理
2025-04-03 22:27:41,347 - helpers.logger - INFO - 创建股票代码搜索和基本信息获取代理
2025-04-03 22:27:41,347 - helpers.logger - INFO - 创建股票代码搜索和基本信息获取代理
2025-04-03 22:27:52,943 - helpers.logger - INFO - start_node处理公司信息完成
2025-04-03 22:27:52,943 - helpers.logger - INFO - start_node处理公司信息完成
2025-04-03 22:46:52,896 - helpers.logger - INFO - 创建股票代码搜索和基本信息获取代理
2025-04-03 22:46:52,897 - helpers.logger - INFO - 创建股票代码搜索和基本信息获取代理
2025-04-03 22:46:52,896 - helpers.logger - INFO - 创建股票代码搜索和基本信息获取代理
2025-04-03 22:46:52,897 - helpers.logger - INFO - 创建股票代码搜索和基本信息获取代理
2025-04-03 22:47:01,462 - helpers.logger - INFO - start_node处理公司信息完成
2025-04-03 22:47:01,462 - helpers.logger - INFO - start_node处理公司信息完成
2025-04-03 22:51:56,364 - helpers.logger - INFO - 创建股票代码搜索和基本信息获取代理
2025-04-03 22:51:56,364 - helpers.logger - INFO - 创建股票代码搜索和基本信息获取代理
2025-04-03 22:52:06,129 - helpers.logger - INFO - start_node处理公司信息完成
2025-04-03 23:10:57,572 - helpers.logger - INFO - 创建股票代码搜索和基本信息获取代理
2025-04-03 23:11:08,180 - helpers.logger - INFO - start_node处理公司信息完成
2025-04-03 23:18:29,422 - helpers.logger - INFO - 创建股票代码搜索和基本信息获取代理
2025-04-03 23:18:38,314 - helpers.logger - INFO - start_node处理公司信息完成
2025-04-03 23:22:13,331 - helpers.logger - INFO - 创建股票代码搜索和基本信息获取代理
2025-04-03 23:22:22,364 - helpers.logger - INFO - start_node处理公司信息完成
2025-04-03 23:31:06,384 - helpers.logger - INFO - 创建股票代码搜索和基本信息获取代理
2025-04-03 23:31:16,888 - helpers.logger - INFO - start_node处理公司信息完成
2025-04-03 23:51:40,256 - helpers.logger - INFO - 创建股票代码搜索和基本信息获取代理
2025-04-03 23:51:52,001 - helpers.logger - INFO - start_node处理公司信息完成
2025-04-03 23:58:33,165 - helpers.logger - INFO - 创建股票代码搜索和基本信息获取代理
2025-04-03 23:58:42,313 - helpers.logger - INFO - start_node处理公司信息完成
2025-04-04 00:08:09,092 - helpers.logger - INFO - 创建股票代码搜索和基本信息获取代理
2025-04-04 00:08:18,321 - helpers.logger - INFO - start_node处理公司信息完成
2025-04-04 00:17:35,847 - helpers.logger - INFO - 创建股票代码搜索和基本信息获取代理
2025-04-04 00:17:46,979 - helpers.logger - INFO - start_node处理公司信息完成
2025-04-04 16:29:31,037 - helpers.logger - INFO - 创建股票代码搜索和基本信息获取代理
2025-04-04 16:29:36,007 - helpers.logger - INFO - start_node处理公司信息完成
2025-04-04 16:40:21,905 - helpers.logger - INFO - 创建股票代码搜索和基本信息获取代理
2025-04-04 16:40:34,246 - helpers.logger - INFO - start_node处理公司信息完成
2025-04-04 16:48:18,044 - helpers.logger - INFO - 创建股票代码搜索和基本信息获取代理
2025-04-04 16:48:29,041 - helpers.logger - INFO - start_node处理公司信息完成
2025-04-04 16:58:51,934 - helpers.logger - INFO - 创建股票代码搜索和基本信息获取代理
2025-04-04 16:59:01,534 - helpers.logger - INFO - start_node处理公司信息完成
2025-04-04 17:12:16,742 - helpers.logger - INFO - 创建股票代码搜索和基本信息获取代理
2025-04-04 17:12:27,381 - helpers.logger - INFO - start_node处理公司信息完成
2025-04-04 17:23:34,277 - helpers.logger - INFO - 创建股票代码搜索和基本信息获取代理
2025-04-04 17:23:44,455 - helpers.logger - INFO - start_node处理公司信息完成
2025-04-04 17:35:34,046 - helpers.logger - INFO - 创建股票代码搜索和基本信息获取代理
2025-04-04 17:35:44,030 - helpers.logger - INFO - start_node处理公司信息完成
2025-04-04 18:27:47,016 - helpers.logger - INFO - 创建股票代码搜索和基本信息获取代理
2025-04-04 18:27:58,318 - helpers.logger - INFO - start_node处理公司信息完成
2025-04-05 19:37:57,775 - helpers.logger - INFO - 创建股票代码搜索和基本信息获取代理
2025-04-05 19:38:07,544 - helpers.logger - INFO - start_node处理公司信息完成
2025-04-05 19:53:04,757 - helpers.logger - INFO - 创建股票代码搜索和基本信息获取代理
2025-04-05 19:53:14,685 - helpers.logger - INFO - start_node处理公司信息完成
2025-04-05 20:03:32,746 - helpers.logger - INFO - 创建股票代码搜索和基本信息获取代理
2025-04-05 20:03:44,256 - helpers.logger - INFO - start_node处理公司信息完成
2025-04-05 20:10:21,299 - helpers.logger - INFO - 创建股票代码搜索和基本信息获取代理
2025-04-05 20:10:33,529 - helpers.logger - INFO - start_node处理公司信息完成
2025-04-05 20:19:48,513 - helpers.logger - INFO - 创建股票代码搜索和基本信息获取代理
2025-04-05 20:20:02,427 - helpers.logger - INFO - start_node处理公司信息完成
2025-04-05 20:45:17,584 - helpers.logger - INFO - 创建股票代码搜索和基本信息获取代理
2025-04-05 20:45:27,324 - helpers.logger - INFO - start_node处理公司信息完成
